@using TAS.Resources
@{
    Layout = "~/Views/Shared/_Layout.cshtml";
}

<div class="RubberIntake-page">
    <div class="row">
        <div class="col-xl-12">
            <div class="card table-card">
                <div class="card-body">
                    <!-- ========================================
                         TOOLBAR
                    ======================================== -->
                    <div class="datatable-top">
                        <!-- Left side: Filters -->
                        <div class="button_filter">
                            <div class="divboxOrder">
                                <label>@Language.key_agent</label>
                                <select id="cboAgent" class="form-control form-control-sm cboSelect2Search"></select>
                            </div>

                            <div class="divboxOrder">
                                <label>@Language.key_nhavuon</label>
                                <select id="cboFarm" class="form-control form-control-sm cboSelect2Search"></select>
                            </div>

                            <div class="divboxOrder">
                                <label>@Language.key_donhang</label>
                                <select id="cboOrder" class="form-control form-control-sm cboSelect2Search"></select>
                            </div>

                            <div class="divboxOrder">
                                <label>@Language.key_trangthai</label>
                                <select id="cboStatus" class="form-control form-control-sm cboSelect2NoSearch" style="width: 150px">
                                    <option value="">Vui lòng chọn</option>
                                    <option value="0">Chưa duyệt</option>
                                    <option value="1">Chờ xử lý</option>
                                    <option value="2">Đã vào hồ</option>
                                    <option value="3">Hoàn thành</option>
                                </select>
                            </div>
                            <div class="divboxOrder">
                                <label>@Language.key_loainguyenlieu</label>
                                <select id="CboType" class="form-select cboSelect2NoSearch">
                                    <option value="">Vui lòng chọn</option>
                                    <option value="1">Mủ Nước</option>
                                    <option value="2">Mủ Đông</option>
                                    <option value="3">Mủ Ly Tâm</option>
                                </select>
                            </div>
                            <div class="divboxOrder">                       
                                <button type="button" class="btn btn-custom-tas-action btn-sm" onclick="clearFilter()">
                                    <i class="fas fa-eraser"></i> Xóa lọc
                                </button>
                            </div>
                        </div>

                        <!-- Right side: Actions -->
                        <div class="datatable-actions">
                            <button type="button" class="btn btn-custom-tas-action btn-sm" onclick="addNewRow()">
                                <i class="fas fa-plus"></i> <span>@Language.key_themmoi</span>
                            </button>
                            @* <button type="button" class="btn btn-custom-tas btn-sm" onclick="saveAll()">
                                <i class="fas fa-save"></i> Lưu tất cả
                            </button> *@
                            <button type="button" class="btn btn-custom-tas-action btn-sm" onclick="approveAll()">
                                <i class="ti ti-check"></i> Duyệt tất cả
                            </button>
                            <button type="button" class="btn btn-custom-tas-action btn-sm" onclick="deleteSelected()">
                                <i class="ti ti-trash"></i> Xóa đã chọn
                            </button>
                            <button type="button" class="btn btn-custom-tas-action btn-sm" onclick="importExcel()">
                                <i class="ti ti-file-import"></i> <span>@Language.key_importexcel</span>
                            </button>
                            <button type="button" class="btn btn-custom-tas-action btn-sm" onclick="exportExcel()">
                                <i class="ti ti-file-export"></i> <span>@Language.key_xuatexcel</span>
                            </button>
                            <button type="button" class="btn btn-custom-tas-action btn-sm" onclick="reloadPage()">
                                <i class="ti ti-refresh"></i> Reload
                            </button>
                        </div>
                    </div>

                    <!-- ========================================
                         AG-GRID TABLE
                    ======================================== -->
                    <div id="myGrid" theme="aggrid" class="ag-theme-quartz-dark" style="height: 600px; width: 100%;"></div>
                    <div id="ag-paging-footer" class="ag-paging-button-wrapper"></div>
                    <!-- ========================================
                         HIDDEN FILE INPUT
                    ======================================== -->
                    <input type="file" id="fileImport" accept=".xlsx,.xls" style="display:none;" onchange="handleFileImport(this)" />
                </div>
            </div>
        </div>
    </div>
</div>

<!-- ========================================
     SCRIPTS
======================================== -->
@section Scripts {
    <!-- Custom JS -->
    <script src="~/Contents/js/RubberIntake.js"></script>
    <script>
        var gridApiIntake, gridColumnApi;
        var agPaging = 'ag-paging-footer';
        var IsOptionAll = false;
        // ========================================
        // INITIALIZATION
        // ========================================
        document.addEventListener('DOMContentLoaded', function() {
            gridApiIntake = agGrid.createGrid(document.querySelector("#myGrid"), gridOptions,);
            loadData();// Load initial data
            loadAllCombos();// Setup filter change events
            //đăng ký select trang
            $('#selectorPaging').change(function (e) {
                let selectPage = $(this).val();
                IsOptionAll = selectPage == '*';
                loadData();
            });
            $('#cboAgent,#cboFarm,#cboOrder,#cboStatus').change(function (e) {
                loadData();
            });
            $('#CboType').change(function (e) {
                let dataType = $(this).val();
                FilterType(dataType);
            });
            setTheme();
            setTimeout(() => {
                ApplyCboSelect2();
                RegisterCheckAll();
            }, 1000);
        });
    </script>
}

@section Styles {
    <!-- Custom CSS -->
    <link rel="stylesheet" href="~/Contents/css/RubberIntake.css" /> 
}