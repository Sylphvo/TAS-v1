
    <!-- Leaflet CSS -->
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css"
          integrity="sha256-p4NxAoJBhIIN+hmNHrzRCf9tD/miZyoHS5obTRR9BMY="
          crossorigin="" />

    <!-- Leaflet Draw CSS -->
    <link rel="stylesheet" href="https://unpkg.com/leaflet-draw@1.0.4/dist/leaflet.draw.css" />

    <!-- Google Fonts -->
    <link href="https://fonts.googleapis.com/css2?family=JetBrains+Mono:wght@400;600&family=Space+Grotesk:wght@400;600;700&display=swap" rel="stylesheet">

    <style>
       

        .container {
            display: flex;
            flex-direction: column;
            height: 100vh;
        }

        /* Header */
        .header {
            background: #1e293b;
            border-bottom: 1px solid #334155;
            padding: 1rem 1.5rem;
            display: flex;
            align-items: center;
            justify-content: space-between;
        }

        .logo-section {
            display: flex;
            align-items: center;
            gap: 0.75rem;
        }

        .logo {
            width: 40px;
            height: 40px;
            border-radius: 0.5rem;
            background: linear-gradient(135deg, #f59e0b 0%, #ec4899 100%);
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.5rem;
        }

        .logo-text h1 {
            font-size: 1.25rem;
            font-weight: 700;
            background: linear-gradient(135deg, #f59e0b 0%, #ec4899 100%);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }

        .logo-text p {
            font-size: 0.75rem;
            color: #94a3b8;
        }

        .toolbar {
            display: flex;
            gap: 0.5rem;
        }

        .btn {
            padding: 0.5rem 1rem;
            border: none;
            border-radius: 0.5rem;
            font-size: 0.875rem;
            font-weight: 500;
            cursor: pointer;
            display: flex;
            align-items: center;
            gap: 0.5rem;
            transition: all 0.2s cubic-bezier(0.4, 0, 0.2, 1);
            font-family: 'Space Grotesk', sans-serif;
        }

            .btn:hover {
                transform: translateY(-2px);
            }

            .btn:active {
                transform: translateY(0);
            }

        .btn-secondary {
            background: #334155;
            color: #f1f5f9;
        }

            .btn-secondary:hover {
                background: #475569;
            }

        .btn-primary {
            background: linear-gradient(135deg, #f59e0b 0%, #ec4899 100%);
            color: white;
        }

            .btn-primary:hover {
                background: linear-gradient(135deg, #f59e0b 20%, #ec4899 120%);
            }

        .btn-danger {
            background: #ef4444;
            color: white;
        }

            .btn-danger:hover {
                background: #dc2626;
            }

        /* Main Content */
        .main-content {
            display: flex;
            flex: 1;
            overflow: hidden;
        }

        .map-panel {
            flex: 1;
            position: relative;
        }

        #map {
            width: 100%;
            height: 100%;
        }

        .leaflet-container {
            background: #0f172a;
        }

        .loading {
            position: absolute;
            inset: 0;
            display: flex;
            align-items: center;
            justify-content: center;
            background: #0f172a;
            flex-direction: column;
            gap: 1rem;
        }

        .spinner {
            width: 2rem;
            height: 2rem;
            border: 3px solid #334155;
            border-top-color: #f59e0b;
            border-radius: 50%;
            animation: spin 1s linear infinite;
        }

      

        /* Editor Panel */
        .editor-panel {
            width: 33.333%;
            background: #1e293b;
            border-left: 1px solid #334155;
            display: flex;
            flex-direction: column;
        }

        .editor-header {
            padding: 0.75rem 1rem;
            background: #0f172a;
            border-bottom: 1px solid #334155;
            display: flex;
            align-items: center;
            justify-content: space-between;
        }

        .editor-title {
            display: flex;
            align-items: center;
            gap: 0.5rem;
            font-weight: 600;
        }

        .feature-count {
            font-size: 0.75rem;
            color: #94a3b8;
        }

        #jsonEditor {
            flex: 1;
            background: #0f172a;
            color: #f1f5f9;
            padding: 1rem;
            resize: none;
            border: none;
            font-family: 'JetBrains Mono', monospace;
            font-size: 0.875rem;
            line-height: 1.6;
        }

            #jsonEditor:focus {
                outline: none;
                box-shadow: inset 0 0 0 2px rgba(245, 158, 11, 0.3);
            }

        .editor-footer {
            padding: 0.75rem 1rem;
            background: #0f172a;
            border-top: 1px solid #334155;
            font-size: 0.75rem;
            color: #94a3b8;
            line-height: 1.6;
        }

            .editor-footer p {
                margin: 0.25rem 0;
            }

        /* Status Bar */
        .status-bar {
            background: #1e293b;
            border-top: 1px solid #334155;
            padding: 0.5rem 1.5rem;
            display: flex;
            align-items: center;
            justify-content: space-between;
            font-size: 0.75rem;
            color: #94a3b8;
        }

        .status-right {
            display: flex;
            align-items: center;
            gap: 1rem;
        }

        .status-indicator {
            display: flex;
            align-items: center;
            gap: 0.25rem;
        }

        .status-dot {
            width: 0.5rem;
            height: 0.5rem;
            border-radius: 50%;
            background: #22c55e;
            animation: pulse 2s infinite;
        }

       
        .hidden {
            display: none !important;
        }

        /* Leaflet Draw Styling */
        .leaflet-draw-toolbar a {
            background-color: #1e293b !important;
            border-color: #334155 !important;
        }

            .leaflet-draw-toolbar a:hover {
                background-color: #334155 !important;
            }
    </style>
<body>
    <div class="container">
        <!-- Header -->
        <div class="header">
            <div class="logo-section">
                <div class="logo">üìç</div>
                <div class="logo-text">
                    <h1>GeoJSON Editor</h1>
                    <p>Create & edit geographic data</p>
                </div>
            </div>

            <div class="toolbar">
                <label class="btn btn-secondary">
                    üì§ Import
                    <input type="file" id="importFile" accept=".geojson,.json" class="hidden">
                </label>

                <button class="btn btn-primary" id="exportBtn">
                    üì• Export
                </button>

                <button class="btn btn-danger" id="clearBtn">
                    üóëÔ∏è Clear
                </button>
            </div>
        </div>

        <!-- Main Content -->
        <div class="main-content">
            <!-- Map Panel -->
            <div class="map-panel">
                <div id="map"></div>
                <div id="loading" class="loading">
                    <div class="spinner"></div>
                    <p>Loading map...</p>
                </div>
            </div>

            <!-- Editor Panel -->
            <div class="editor-panel">
                <div class="editor-header">
                    <div class="editor-title">
                        ‚úèÔ∏è GeoJSON Code
                    </div>
                    <div class="feature-count" id="featureCount">0 features</div>
                </div>

                <textarea id="jsonEditor" placeholder="GeoJSON will appear here..." spellcheck="false"></textarea>

                <div class="editor-footer">
                    <p><strong>üí° Tips:</strong></p>
                    <p>‚Ä¢ Use drawing tools on the map to add features</p>
                    <p>‚Ä¢ Edit JSON directly and it updates in real-time</p>
                    <p>‚Ä¢ Click features on map to see properties</p>
                </div>
            </div>
        </div>

        <!-- Status Bar -->
        <div class="status-bar">
            <div id="statusMessage">Ready to create</div>
            <div class="status-right">
                <span id="mapStatus">Loading...</span>
                <span class="status-indicator">
                    <div class="status-dot"></div>
                    Online
                </span>
            </div>
        </div>
    </div>

    <script>
        // Application State
        let map = null;
        let drawnItems = null;
        let geojson = {
            type: "FeatureCollection",
            features: []
        };
        let isUpdatingFromMap = false;
        let isUpdatingFromEditor = false;
        let scriptsLoaded = 0;

        // Function to check if all scripts are loaded
        function checkScriptsLoaded() {
            scriptsLoaded++;
            if (scriptsLoaded === 2) {
                // All scripts loaded, initialize app
                initializeApp();
            }
        }

        // Initialize Map
        function initMap() {
            // Create map
            map = L.map('map').setView([21.0285, 105.8542], 6);

            // Add tile layer
            L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
                attribution: '¬© OpenStreetMap contributors',
                maxZoom: 19
            }).addTo(map);

            // Create feature group for drawn items
            drawnItems = new L.FeatureGroup();
            map.addLayer(drawnItems);

            // Add draw control
            const drawControl = new L.Control.Draw({
                position: 'topright',
                draw: {
                    polygon: true,
                    polyline: true,
                    rectangle: true,
                    circle: true,
                    marker: true,
                    circlemarker: false
                },
                edit: {
                    featureGroup: drawnItems,
                    remove: true
                }
            });
            map.addControl(drawControl);

            // Event listeners
            map.on(L.Draw.Event.CREATED, function (e) {
                const layer = e.layer;
                drawnItems.addLayer(layer);

                const geoJsonFeature = layer.toGeoJSON();
                geoJsonFeature.properties = {
                    name: `Feature ${geojson.features.length + 1}`,
                    description: ''
                };

                updateGeoJSONFromMap();
            });

            map.on(L.Draw.Event.EDITED, function (e) {
                updateGeoJSONFromMap();
            });

            map.on(L.Draw.Event.DELETED, function (e) {
                updateGeoJSONFromMap();
            });

            // Hide loading
            document.getElementById('loading').classList.add('hidden');
            document.getElementById('mapStatus').textContent = 'Ready';
        }

        // Update GeoJSON from map
        function updateGeoJSONFromMap() {
            if (isUpdatingFromEditor) return;

            isUpdatingFromMap = true;

            const features = [];
            drawnItems.eachLayer(function (layer) {
                features.push(layer.toGeoJSON());
            });

            geojson = {
                type: "FeatureCollection",
                features: features
            };

            updateEditor();
            isUpdatingFromMap = false;
        }

        // Update editor
        function updateEditor() {
            const editor = document.getElementById('jsonEditor');
            editor.value = JSON.stringify(geojson, null, 2);
            updateFeatureCount();
        }

        // Update map from GeoJSON
        function updateMapFromGeoJSON(geoJsonData) {
            if (isUpdatingFromMap) return;

            isUpdatingFromEditor = true;

            drawnItems.clearLayers();

            L.geoJSON(geoJsonData, {
                onEachFeature: function (feature, layer) {
                    drawnItems.addLayer(layer);

                    if (feature.properties) {
                        const popup = `<strong>${feature.properties.name || 'Unnamed'}</strong><br/>${feature.properties.description || ''}`;
                        layer.bindPopup(popup);
                    }
                },
                pointToLayer: function (feature, latlng) {
                    return L.marker(latlng);
                }
            });

            // Fit bounds if features exist
            if (geoJsonData.features && geoJsonData.features.length > 0) {
                const bounds = drawnItems.getBounds();
                if (bounds.isValid()) {
                    map.fitBounds(bounds, { padding: [50, 50] });
                }
            }

            isUpdatingFromEditor = false;
        }

        // Update feature count
        function updateFeatureCount() {
            const count = geojson.features.length;
            document.getElementById('featureCount').textContent =
                `${count} feature${count !== 1 ? 's' : ''}`;
        }

        // Handle editor change
        function handleEditorChange() {
            const editor = document.getElementById('jsonEditor');
            const text = editor.value;

            try {
                const parsed = JSON.parse(text);
                if (parsed.type === 'FeatureCollection') {
                    geojson = parsed;
                    updateMapFromGeoJSON(parsed);
                    updateFeatureCount();
                    document.getElementById('statusMessage').textContent = 'GeoJSON updated';
                }
            } catch (err) {
                document.getElementById('statusMessage').textContent = 'Invalid JSON';
            }
        }

        // Export GeoJSON
        function exportGeoJSON() {
            const blob = new Blob([JSON.stringify(geojson, null, 2)], {
                type: 'application/json'
            });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = 'map.geojson';
            a.click();
            URL.revokeObjectURL(url);
            document.getElementById('statusMessage').textContent = 'GeoJSON exported';
        }

        // Import GeoJSON
        function importGeoJSON(file) {
            const reader = new FileReader();
            reader.onload = function (event) {
                try {
                    const imported = JSON.parse(event.target.result);
                    geojson = imported;
                    updateEditor();
                    updateMapFromGeoJSON(imported);
                    document.getElementById('statusMessage').textContent = 'GeoJSON imported';
                } catch (err) {
                    alert('Invalid GeoJSON file');
                    document.getElementById('statusMessage').textContent = 'Import failed';
                }
            };
            reader.readAsText(file);
        }

        // Clear all features
        function clearAll() {
            if (confirm('Clear all features?')) {
                geojson = {
                    type: "FeatureCollection",
                    features: []
                };
                updateEditor();
                drawnItems.clearLayers();
                document.getElementById('statusMessage').textContent = 'All features cleared';
            }
        }

        // Initialize application
        function initializeApp() {
            // Initialize map
            initMap();

            // Initial editor state
            updateEditor();

            // Editor change
            let editorTimeout;
            document.getElementById('jsonEditor').addEventListener('input', function () {
                clearTimeout(editorTimeout);
                editorTimeout = setTimeout(handleEditorChange, 500);
            });

            // Import
            document.getElementById('importFile').addEventListener('change', function (e) {
                const file = e.target.files[0];
                if (file) {
                    importGeoJSON(file);
                }
                // Reset input
                this.value = '';
            });

            // Export
            document.getElementById('exportBtn').addEventListener('click', exportGeoJSON);

            // Clear
            document.getElementById('clearBtn').addEventListener('click', clearAll);
        }
    </script>

    <!-- Leaflet JS -->
    <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"
            integrity="sha256-20nQCchB9co0qIjJZRGuk2/Z9VM+kNiyxNV1lvTlZBo="
            crossorigin=""
            onload="checkScriptsLoaded()"></script>

    <!-- Leaflet Draw JS -->
    <script src="https://unpkg.com/leaflet-draw@1.0.4/dist/leaflet.draw.js"
            onload="checkScriptsLoaded()"></script>
</body>
